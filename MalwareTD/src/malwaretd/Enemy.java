package malwaretd;

import java.awt.Image;
import java.awt.Polygon;
import java.util.List;

import jgame.Context;
import jgame.GObject;
import jgame.GSprite;
import jgame.controller.PolygonController;
import jgame.controller.PulsateController;
import jgame.listener.BoundaryRemovalListener;
import jgame.listener.HitTestListener;
import jgame.listener.FrameListener;

public abstract class Enemy extends GSprite {

	private double maxBytes;
	private double currentBytes;
	private double maxSlow;
	private double currentSlow;
	

	public Enemy(Image image, double maxBytes) {
		super(image);
		this.maxBytes = this.currentBytes = getMaxBytes()*2;
		this.maxSlow = this.currentSlow = getSlowness();
		int[] x = new int[] { 182, 182, 208, 233, 258, 283, 309, 334, 360, 385,
				411, 437, 462, 464, 463, 440, 415, 389, 364, 339, 313, 288,
				262, 236, 211, 186, 163, 155, 156, 178, 204, 231, 256, 283,
				308, 334, 359, 384, 411, 436, 461, 485, 493, 500, 502, 479,
				453, 428, 403, 378, 352, 327, 300, 274, 249, 224, 198, 172,
				147, 126, 120, 112, 115, 123, 149, 174, 199, 224, 249, 275,
				301, 327, 352, 377, 404, 430, 456, 482, 508, 533, 10000 };
		int[] y = new int[] { 17, 34, 34, 36, 37, 36, 36, 37, 37, 38, 38, 38,
				43, 68, 93, 103, 105, 105, 104, 101, 101, 102, 101, 101, 105,
				107, 118, 142, 167, 180, 183, 184, 187, 190, 191, 191, 189,
				183, 183, 184, 188, 196, 220, 246, 271, 282, 281, 285, 290,
				292, 292, 288, 285, 285, 287, 291, 292, 292, 296, 312, 337,
				362, 387, 411, 418, 422, 425, 427, 423, 423, 423, 423, 424,
				427, 427, 429, 429, 429, 429, 426, 100000 };

		Polygon p = new Polygon(x, y, 81);
		final PolygonController pc = new PolygonController(p);

		pc.goToStart(this);
		addController(pc);

		FrameListener slowl = new FrameListener() {

			@Override
			public void invoke(GObject target, Context context) {
				// TODO Auto-generated method stub
				pc.setMaxSpeed(currentSlow * 2);
			}	
		};
		addListener(slowl);
		

		BoundaryRemovalListener bd = new BoundaryRemovalListener();

		PulsateController pc1 = new PulsateController(0.8, 0.2, 30);
		pc1.setProperties(PulsateController.SCALE, PulsateController.ALPHA);

		addListener(bd);
		addController(pc1);
		addController(pc);

		HitTestListener htl = new HitTestListener(Bullet.class) {
			@Override
			public void invoke(GObject target, Context context) {
				List<Bullet> list = context.hitTestClass(Bullet.class);
				for (Bullet b : list) {
					currentBytes -= b.bulletPowa;
					currentSlow += b.bulletSlowing;
					
					// subtract bytes
					// remove bullet
					b.removeSelf();
				}
				// if negative/zero health, remove self
				if (currentBytes <= 0)
					target.removeSelf();
			}
			
		};
		
		HitTestListener htl2 = new HitTestListener(Goal.class) {
			@Override
			public void invoke(GObject target, Context context) {
					target.removeSelf();
			}
			
		};
		
		addListener(htl);
		addListener(htl2);

	}

	public abstract double getSlowness();
	public abstract double getMaxBytes();

}
