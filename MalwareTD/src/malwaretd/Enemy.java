package malwaretd;

import java.awt.Image;
import java.awt.Polygon;
import java.util.List;

import jgame.Context;
import jgame.GObject;
import jgame.GSprite;
import jgame.controller.PolygonController;
import jgame.controller.PulsateController;
import jgame.listener.BoundaryRemovalListener;
import jgame.listener.HitTestListener;
import jgame.listener.FrameListener;

public abstract class Enemy extends GSprite {

	private double maxBytes;
	private double currentBytes;
	private double maxSlow;
	private double currentSlow;
	private int Reward;
	int ScrewYouStefan = 0;

	public Enemy(Image image, double maxBytes) {
		super(image);
		this.maxBytes = this.currentBytes = getMaxBytes()*2;
		this.maxSlow = this.currentSlow = getSlowness();
		this.Reward = getReward();
		int[] x = new int[] { 324, 324, 324, 349, 374, 400, 425, 450, 475, 500, 500, 500,
				500, 500, 500, 500, 519, 544, 562, 566, 566, 566, 566, 566, 563, 541, 516,
				491, 466, 442, 439, 439, 439, 439, 439, 439, 424, 399, 374, 349, 324, 297,
				272, 246, 219, 200, 196, 196, 196, 196, 196, 196, 170, 145, 118, 92, 76, 76, 
				76, 76, 75, 75, 75, 97, 122, 140, 144, 144, 144, 144, 144, 144, 169, 195, 221,
				247, 274, 299, 323, 321, 319, 319, 321, 324, 324, 324, 324, 324, 324, 324, 324,
				324, 324, 324, 324, 324, 324, 324, 324, 324, 324 };
		int[] y = new int[] { 3, 28, 50, 50, 50, 50, 50, 50, 50, 60, 85, 110, 135, 160, 185, 210,
				230, 233, 252, 277, 302, 327, 353, 380, 405, 418, 416, 414, 413, 405, 379, 353,
				327, 301, 276, 250, 228, 225, 228, 229, 229, 229, 227, 226, 227, 244, 269, 294,
				320, 346, 372, 397, 410, 415, 415, 412, 392, 366, 340, 313, 288, 262, 236, 224,
				223, 205, 179, 153, 128, 103, 78, 52, 50, 50, 49, 49, 49, 48, 56, 82, 107, 133,
				158, 183, 208, 234, 260, 286, 312, 338, 364, 389, 416, 441, 466, 492, 518, 544,
				570, 595, 620 };
		Polygon p = new Polygon(x, y, 101);
		final PolygonController pc = new PolygonController(p);
//		int[] x = new int[] { 182, 182, 208, 233, 258, 283, 309, 334, 360, 385,
//				411, 437, 462, 464, 463, 440, 415, 389, 364, 339, 313, 288,
//				262, 236, 211, 186, 163, 155, 156, 178, 204, 231, 256, 283,
//				308, 334, 359, 384, 411, 436, 461, 485, 493, 500, 502, 479,
//				453, 428, 403, 378, 352, 327, 300, 274, 249, 224, 198, 172,
//				147, 126, 120, 112, 115, 123, 149, 174, 199, 224, 249, 275,
//				301, 327, 352, 377, 404, 430, 456, 482, 508, 533};
//		int[] y = new int[] { 17, 34, 34, 36, 37, 36, 36, 37, 37, 38, 38, 38,
//				43, 68, 93, 103, 105, 105, 104, 101, 101, 102, 101, 101, 105,
//				107, 118, 142, 167, 180, 183, 184, 187, 190, 191, 191, 189,
//				183, 183, 184, 188, 196, 220, 246, 271, 282, 281, 285, 290,
//				292, 292, 288, 285, 285, 287, 291, 292, 292, 296, 312, 337,
//				362, 387, 411, 418, 422, 425, 427, 423, 423, 423, 423, 424,
//				427, 427, 429, 429, 429, 429, 426};


		pc.goToStart(this);
		addController(pc);

		FrameListener slowl = new FrameListener() {

			@Override
			public void invoke(GObject target, Context context) {
				// TODO Auto-generated method stub
				pc.setMaxSpeed(currentSlow * 2);
			}	
		};
		addListener(slowl);
		

		BoundaryRemovalListener bd = new BoundaryRemovalListener();

		PulsateController pc1 = new PulsateController(0.8, 0.2, 30);
		pc1.setProperties(PulsateController.SCALE, PulsateController.ALPHA);

		addListener(bd);
		addController(pc1);
		addController(pc);

		HitTestListener htl = new HitTestListener(Bullet.class) {
			@Override
			public void invoke(GObject target, Context context) {
				List<Bullet> list = context.hitTestClass(Bullet.class);
				for (Bullet b : list) {
					currentBytes -= b.bulletPowa;
					if (currentSlow >5)
						currentSlow += b.bulletSlowing;
					
					// subtract bytes
					// remove bullet
					b.removeSelf();
				}
				
				// if negative/zero health, remove self
				if (currentBytes <= 0)
					{
					getFirstAncestorOf(GameView.class).pointbank.changeBankValue(Reward);
					target.removeSelf();
					}
			}
			
		};
		
		
		
		addListener(htl);


	}

	public abstract double getSlowness();
	public abstract double getMaxBytes();
	public abstract int getReward();

}
